/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.marl8n.usersandarduino.ui;

import static com.marl8n.usersandarduino.arduino.ArduinoConnection.ino;
import com.marl8n.usersandarduino.connectiontodb.InitConnection;
import com.marl8n.usersandarduino.service.UserService;
import com.panamahitek.ArduinoException;
import java.sql.Connection;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import jssc.SerialPortEvent;
import jssc.SerialPortEventListener;
import jssc.SerialPortException;

/**
 *
 * @author MIDP9
 */
public class MainUI extends javax.swing.JFrame {
    
    
    public SerialPortEventListener spl = new SerialPortEventListener() {
        @Override
        public void serialEvent(SerialPortEvent spe) {
            try {
                if ( ino.isMessageAvailable()) {
                    loginForm();
                }
            } catch (SerialPortException ex) {
                Logger.getLogger(MainUI.class.getName()).log(Level.SEVERE, null, ex);
            } catch (ArduinoException ex) {
                Logger.getLogger(MainUI.class.getName()).log(Level.SEVERE, null, ex);
            }
            try {
                ino.sendData("1");
            } catch (ArduinoException ex) {
                Logger.getLogger(MainUI.class.getName()).log(Level.SEVERE, null, ex);
            } catch (SerialPortException ex) {
                Logger.getLogger(MainUI.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    };
    

    InitConnection initConnection = new InitConnection();
    IFCreateUser ifcu = null;
    IFListUsers iflsu = null;
    IFLogin ifli = null;
    IFDatesBetween ifdb = null;
    
    /**
     * Creates new form MainUI
     */
    public MainUI() {
        initComponents();
        try ( Connection cnt = initConnection.getConnection() ) {
            //
        } catch ( Exception e ) {
            JOptionPane.showConfirmDialog(rootPane, e);
        }
        try {
            ino.arduinoRXTX("COM5", 9600, spl);
        } catch (ArduinoException ex) {
            Logger.getLogger(MainUI.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        dp1 = new javax.swing.JDesktopPane();
        jMenuBar1 = new javax.swing.JMenuBar();
        jMenu1 = new javax.swing.JMenu();
        userOpt = new javax.swing.JMenu();
        listUsers = new javax.swing.JMenuItem();
        createUser = new javax.swing.JMenuItem();
        login = new javax.swing.JMenuItem();
        ifDateBetween = new javax.swing.JMenuItem();
        jMenuItem2 = new javax.swing.JMenuItem();
        jMenuItem1 = new javax.swing.JMenuItem();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        javax.swing.GroupLayout dp1Layout = new javax.swing.GroupLayout(dp1);
        dp1.setLayout(dp1Layout);
        dp1Layout.setHorizontalGroup(
            dp1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 400, Short.MAX_VALUE)
        );
        dp1Layout.setVerticalGroup(
            dp1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 276, Short.MAX_VALUE)
        );

        jMenu1.setText("Options");

        userOpt.setText("Users");

        listUsers.setText("List users");
        listUsers.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                listUsersActionPerformed(evt);
            }
        });
        userOpt.add(listUsers);

        createUser.setText("Create User");
        createUser.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                createUserActionPerformed(evt);
            }
        });
        userOpt.add(createUser);

        login.setText("Log in");
        login.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                loginActionPerformed(evt);
            }
        });
        userOpt.add(login);

        ifDateBetween.setText("Dates Between");
        ifDateBetween.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                ifDateBetweenActionPerformed(evt);
            }
        });
        userOpt.add(ifDateBetween);

        jMenuItem2.setText("Less visits");
        jMenuItem2.setToolTipText("");
        jMenuItem2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem2ActionPerformed(evt);
            }
        });
        userOpt.add(jMenuItem2);

        jMenu1.add(userOpt);

        jMenuItem1.setText("Active visits");
        jMenuItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem1ActionPerformed(evt);
            }
        });
        jMenu1.add(jMenuItem1);

        jMenuBar1.add(jMenu1);

        setJMenuBar(jMenuBar1);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(dp1)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(dp1)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void createUserActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_createUserActionPerformed
        if (ifcu == null || ifcu.isClosed() ) {
            ifcu = new IFCreateUser();
            dp1.add(ifcu);
        }
        ifcu.show();
    }//GEN-LAST:event_createUserActionPerformed

    private void listUsersActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_listUsersActionPerformed
        if ( iflsu == null || iflsu.isClosed() ) {
            iflsu = new IFListUsers();
            dp1.add(iflsu);
        }
        iflsu.show();
    }//GEN-LAST:event_listUsersActionPerformed

    private void loginActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loginActionPerformed
        if ( ifli == null || ifli.isClosed() ) {
            ifli = new IFLogin();
            dp1.add(ifli);
        }
        ifli.show();
    }//GEN-LAST:event_loginActionPerformed

    private void ifDateBetweenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_ifDateBetweenActionPerformed
        if ( ifdb == null || ifdb.isClosed() ) {
            ifdb = new IFDatesBetween();
            dp1.add(ifdb);
        }
        ifdb.show();
    }//GEN-LAST:event_ifDateBetweenActionPerformed

    private void jMenuItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem1ActionPerformed
        VisitsInsights.howManyVisits();
    }//GEN-LAST:event_jMenuItem1ActionPerformed

    private void jMenuItem2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem2ActionPerformed
        VisitsInsights.lessVisits();
    }//GEN-LAST:event_jMenuItem2ActionPerformed

    public void loginForm() {
        if ( ifli == null || ifli.isClosed() ) {
            ifli = new IFLogin();
            dp1.add(ifli);
        }
        ifli.show();
    }
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(MainUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(MainUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(MainUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(MainUI.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new MainUI().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JMenuItem createUser;
    private javax.swing.JDesktopPane dp1;
    private javax.swing.JMenuItem ifDateBetween;
    private javax.swing.JMenu jMenu1;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JMenuItem jMenuItem1;
    private javax.swing.JMenuItem jMenuItem2;
    private javax.swing.JMenuItem listUsers;
    private javax.swing.JMenuItem login;
    private javax.swing.JMenu userOpt;
    // End of variables declaration//GEN-END:variables
}
